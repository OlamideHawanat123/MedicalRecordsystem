<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Doctor–Patient Private Chat</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #f8f9fa;
            padding: 20px;
        }
        h2 {
            color: #333;
        }
        textarea {
            width: 100%;
            height: 300px;
            resize: none;
            border-radius: 8px;
            border: 1px solid #ccc;
            padding: 10px;
            font-size: 15px;
            background: #fff;
        }
        input {
            width: 80%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 15px;
        }
        button {
            padding: 10px 15px;
            border: none;
            background: #007bff;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
<h2>Doctor–Patient Private Chat</h2>

<textarea id="log" readonly placeholder="Messages will appear here..."></textarea><br />
<input id="message" placeholder="Type your message here..." />
<button onclick="sendPrivate()">Send</button>

<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
<script>
    const socket = new SockJS("http://localhost:8081/ws"); // Update if your backend port changed
    const stompClient = Stomp.over(socket);

    const currentUser = prompt("Enter your ID (doctor1 or patient1)");
    const targetUser = prompt("Enter receiver ID (doctor1 or patient1)");

    stompClient.connect({}, () => {
        console.log("Connected as", currentUser);

        stompClient.subscribe(`/user/${currentUser}/queue/private`, (message) => {
            const body = JSON.parse(message.body);
            console.log("Received:", body);

            const log = document.getElementById("log");
            log.value += `${body.senderId}: ${body.content}\n`;
            log.scrollTop = log.scrollHeight; // auto-scroll to bottom
        });
    });

    function sendPrivate() {
        const text = document.getElementById("message").value;
        if (text && stompClient) {
            stompClient.send(
                "/app/private-message",
                {},
                JSON.stringify({
                    senderId: currentUser,
                    receiverId: targetUser,
                    content: text,
                })
            );

            // show sent message immediately
            const log = document.getElementById("log");
            log.value += `You: ${text}\n`;
            log.scrollTop = log.scrollHeight;

            document.getElementById("message").value = "";
        }
    }
</script>
</body>
</html>
